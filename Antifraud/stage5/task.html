<h2>Description</h2>
<h1> Do we need transaction id? Lets do it in the next stage</h1>

<p>A rule-based system is an artificial intelligence based software which take advantages of human defined rules in ord
    to automate processes of a given business.
</p>
<p>In this part we implement a rule based system, considering the different types of the transactions as well as
    a history of transactions on the card.
<h3>Transaction Types</h3>
<p>
    There are a variety of transactions that can be applied on a card. Basically, it worse to consider what is provided
    by a
    payment in order to realize whether it is a valid transaction. For instance assume a case that a payment of 200
    Dollars
    is queried for ordering some foods. Clearly, it seems strenge that someone pays such amount in order to buy food. On
    the
    other hand assume the same amount is paid to buy an insurance. In this case it seems more reasonable. The following
    table
    shows an example set of transaction types and their allowed values. The transaction types with the amount lower than
    <i>Max Allowed</i> are considered valid, between <i>Max Allowed</i> and <i>Max Manual</i> needs manual and
    validation
    and more than <i>Max Manual</i> are considered as <i>Prohibited</i>.
</p>
<table border="1" cellpadding="1" cellspacing="1" style="width:500px">
    <tr>
        <td>Transaction Type</td>
        <td>Max Allowed</td>
        <td>Max Manual</td>
    </tr>
    <tbody>
    <tr>
        <td>insurance</td>
        <td>400</td>
        <td>1200</td>
    </tr>
    <tr>
        <td>real ware</td>
        <td>200</td>
        <td>500</td>
    </tr>
    <tr>
        <td>food</td>
        <td>150</td>
        <td>300</td>
    </tr>
    <tr>
        <td>online ware</td>
        <td>150</td>
        <td>300</td>
    </tr>
    <tr>
        <td>transfer</td>
        <td>300</td>
        <td>900</td>
    </tr>
    </tbody>
</table>
</li>

In this step a flexible way is provided for the system admins to define the necessary transaction types and define
the values of <i>Max Allowed</i> and <i>Max Manual</i> on it. It enables to distinguish intelligently amongst
different types of transactions.


<p>
    The philosophy behind the rules is that the probability of fraud in different types of the transactions are not the
    same
    e.g. For type insurance the probability is the lowest while a frauder is likely to try some transaction of type
    transfer
</p>

<p>
    The expected amount is also different in each type of transaction. While buying real ware of price 180 seems norma,
    the same amount need manual verification on a transaction of type food.
</p>

<h2>Objectives</h2>
The following are the objectives of this state:
<ol>
    <li><b>Enrich Transaction Model:</b>
        <p>The following properties are added to the transactionmodel</p>

        <ol>
            <li>Transaction date</li>
            <li>Transaction Type</li>
            <li>IP address</li>
        </ol>

    <li><b>Adding Transaction Type:</b>
        <ol>
            <li>Model: consist of the following <i>Not Null</i> properties:
                <ol>
                    <li> <i>typeName</i> unique string
                    </li>
                    <li> <i>max-allowed</i>> (positive integer)</li>
                    <li> <i>max-manual </i>(positive integer and greater than <i>max-allowed</i></li>
                </ol>
                ALL of the properties should be specified().
            </li>
            <li>A new rest controller <i>TransactionTypeRestController</i> with address <i>/api/antifraud/transaction-type</i>
                that expose the following rest requests:
                <ol>
                    <li>POST that returns status code <b>Created(201)</b> for successful, <b>Conflict(409)</b> for
                        duplicate type name, and <b>Unprocessable Entity(422)</b> for invalid entities.</li>
                    <li>GET that returns the list of existing types with code <b>Ok(200)</b></li>
                    <li>DELETE that get a given type name and returns <b>Accepted(202)</b>, <b>No Content(204)</b> for
                        non-existing type name</li>
                </ol>
                which are available only for admin-user and returns <b>Non Authorized(203)</b> for other types of users.
            </li>
        </ol>
    </li>
    <li><b>Enrich transaction model</b> Add the following two fields to the transaction:
        <ol>
            <li>Transaction type name of type String</li>
            <li>Transaction country of type String?</li>
        </ol>
    </li>
    <li>Asking for a validity of transaction(GET /api/antifraud/transaction) get a request body of type
        <i>TransactionQueryRequest</i> instead of <i>Transaction</i> containing three below fields:
        <ol>
            <li><i>transaction</i>: which represent the transaction to be queried</li>
            <li><i>ipCount</i>: represent the number of IPs that the purchase is done in the last 24 hours</li>
            <!--li>new IP: is set to ture if the transaction is done from the new IP address; If it is from an existing IP
                adress in the last 24 hours it is set to false
            </li-->
            <li><i>countryCount</i>: represents the number of countries in the last 24 hours which a transaction took place
                from </li>
            <!--li>new Country: is set to true if it is from a new country; Otherwise if the country already exist in the
                transactions of the last 24 hours, it is set to false
            </li-->
        </ol>
    </li>
    <li><b>Rules</b>
        <p>The following rules are applied for each incoming transaction.</p>
        <ol>
            <li>The rule of stolen card from stage-3 is still valid. That means the transactions from stolen crads are still
                prohibited
            </li>
            <li>The rule of suspicious IP adresses from stage-3 is still valid</li>
            <li>If the transactions in the last 24 hours are from more than 2 countries =&gt; Fraud</li>
            <li>If the transactions in the last 24 hours are from more than 3 IPs =&gt; Fraud</li>
            <li>If the transactions in the last 24 hours are from 2 countries =&gt; Personal</li>
            <li>If the transactions in the last 24 hours are from 3 IPs =&gt; Personal</li>
            <li>The rule on the amount of the transaction, is replaced as follows.
                For each transaction find its type by name and compare the amopunt of the transaction with maxAllowed and
                maxManual
                <ol>
                    <li> If the transaction amount is less than the maxAllowed, it is allowed</li>
                    <li> If the transaction ampunt is less than maxAllowed (but more than maxManual) then it is manual</li>
                    <li> If the transaction amount is greater than maxAllowed of the transactionType, the it is prohibited</li>
                </ol>
            </li>

            <h1>Only one Single message when it is not allowed</h1>
            <!--<li>Rules on transactions amounts for each transactions based on the type

            </li>-->
        </ol>

    </li>

</ol>

<h2>Examples</h2>

<p>...</p>

<p>&nbsp;</p>

<h2> TODO</h2>
<ol>
    <li>Change success response of the DELETE operations to 202(ACCEPTED) instead of 200(OK)</li>
</ol>

<h2>Refrences</h2>

<p>https://en.wikipedia.org/wiki/Rule-based_system</p>

<p>http://www.kr.tuwien.ac.at/education/ewbs_slides/rule-based.pdf</p>
